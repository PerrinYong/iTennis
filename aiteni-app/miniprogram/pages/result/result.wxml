<!--pages/result/result.wxml-->
<!-- 根容器使用.page-container + 动态绑定安全留白 -->
<view class="page-container" style="padding-top: {{safeTopPadding}}rpx;">
  <!-- 加载状态 -->
  <view wx:if="{{isLoading}}" class="loading-container">
    <view class="loading">
      <view class="loading-spinner"></view>
      <text class="loading-text">生成评估结果中...</text>
    </view>
  </view>

  <!-- 结果内容 -->
  <view wx:else class="result-content">
    <!-- Hero卡片 - NTRP等级 -->
    <view class="card card-hero">
      <view class="hero-ball-shadow"></view>
      
      <view class="card-summary">
        <view class="summary-left">
          <view class="summary-level-title">
            <text class="h1">NTRP {{result.overallLevel}}</text>
            <text class="summary-level-subtitle">{{result.levelLabel}}</text>
          </view>
          
          <view class="chip-row">
            <text
              wx:for="{{result.advantageTags}}"
              wx:key="*this"
              class="chip chip-hero"
            >{{item}}</text>
          </view>
          
          <text class="summary-note caption">
            数据基于你的问卷作答，仅供训练参考。
          </text>
        </view>
        
        <view class="summary-right">
          <view class="badge-level">
            <text class="badge-level-main">{{result.overallLevel}}</text>
            <text class="badge-level-sub">NTRP</text>
            <view class="badge-ball">🎾</view>
          </view>
        </view>
      </view>
    </view>

    <!-- 分割线 -->
    <view wx:if="{{showDetail}}" class="section-divider">
      <text class="section-divider-title">整体概览</text>
      <view class="section-divider-line"></view>
    </view>

    <!-- 优势卡片（简略版） -->
    <view class="card card-soft">
      <view class="card-header">
        <view class="card-header-title">
          <text class="emoji-icon">💪</text>
          <text class="h3">你的主要优势</text>
        </view>
        <view class="status-dot status-dot-green"></view>
      </view>
      
      <!-- 简略版：只显示维度名称 -->
      <view wx:if="{{!showDetail}}" class="list">
        <view
          wx:for="{{result.advantages}}"
          wx:key="name"
          class="list-item {{index > 0 ? 'has-border' : ''}}"
        >
          <view class="list-icon list-icon-adv">🎾</view>
          <view class="list-body">
            <view class="list-text-main">
              <text>{{item.name}}</text>
              <text class="chip chip-blue">{{item.score}} 级</text>
            </view>
          </view>
        </view>
        
        <!-- 空状态提示 -->
        <view wx:if="{{result.advantages.length === 0}}" class="empty-hint">
          <text class="empty-hint-text">各维度发展较为均衡</text>
        </view>
      </view>
      
      <!-- 详细版：显示完整描述 -->
      <view wx:else class="list">
        <view
          wx:for="{{result.advantages}}"
          wx:key="name"
          class="list-item {{index > 0 ? 'has-border' : ''}}"
        >
          <view class="list-icon list-icon-adv">🎾</view>
          <view class="list-body">
            <view class="list-text-main">
              <text>{{item.name}}（约 {{item.score}} 级）</text>
              <text class="tag tag-strong">优势</text>
            </view>
            <text class="list-text-sub">{{item.description}}</text>
          </view>
        </view>
        
        <!-- 空状态提示 -->
        <view wx:if="{{result.advantages.length === 0}}" class="empty-hint">
          <text class="empty-hint-text">各维度发展较为均衡，没有特别突出的优势</text>
        </view>
      </view>
    </view>

    <!-- 提升重点卡片 -->
    <view class="card card-soft">
      <view class="card-header">
        <view class="card-header-title">
          <text class="emoji-icon">🎯</text>
          <text class="h3">当前最值得优先提升的环节</text>
        </view>
        <view class="status-dot status-dot-orange"></view>
      </view>
      
      <!-- 简略版：只显示维度名称 -->
      <view wx:if="{{!showDetail}}" class="list">
        <view
          wx:for="{{result.weaknesses}}"
          wx:key="name"
          class="list-item {{index > 0 ? 'has-border' : ''}}"
        >
          <view class="list-icon list-icon-weak">🎯</view>
          <view class="list-body">
            <view class="list-text-main">
              <text>{{item.name}}</text>
              <text class="chip chip-orange">{{item.score}} 级</text>
            </view>
          </view>
        </view>
        
        <!-- 空状态提示 -->
        <view wx:if="{{result.weaknesses.length === 0}}" class="empty-hint">
          <text class="empty-hint-text">各维度发展较为均衡</text>
        </view>
      </view>
      
      <!-- 详细版：显示完整描述 -->
      <view wx:else class="list">
        <view
          wx:for="{{result.weaknesses}}"
          wx:key="name"
          class="list-item {{index > 0 ? 'has-border' : ''}}"
        >
          <view class="list-icon list-icon-weak">🎯</view>
          <view class="list-body">
            <view class="list-text-main">
              <text>{{item.name}}（约 {{item.score}} 级）</text>
              <text class="tag tag-weak">短板</text>
            </view>
            <text class="list-text-sub">{{item.description}}</text>
          </view>
        </view>
        
        <!-- 空状态提示 -->
        <view wx:if="{{result.weaknesses.length === 0}}" class="empty-hint">
          <text class="empty-hint-text">各维度发展较为均衡，建议全面提升</text>
        </view>
      </view>
      
      <view wx:if="{{showDetail && result.weaknesses.length > 0}}" class="hint-text">
        如果你只想抓重点练习，建议先在以上 2–3 个环节上持续投入时间，效果会最明显。
      </view>
      
      <!-- 查看详情按钮 (移至底部栏) -->
      <!-- <view wx:if="{{!showDetail}}" class="card-action">
        <button class="btn-text" bindtap="toggleDetail">
          查看完整评语 →
        </button>
      </view> -->
    </view>

    <!-- 底部占位符 -->
    <view wx:if="{{!showDetail}}" class="bottom-spacer"></view>

    <!-- 各维度详细评估（仅在详细版显示） -->
    <view wx:if="{{showDetail}}" class="card card-soft">
      <view class="card-header">
        <view class="card-header-title">
          <text class="emoji-icon">📝</text>
          <text class="h3">各维度详细评估与建议</text>
        </view>
      </view>

      <view class="dimensions-list">
        <view
          wx:for="{{result.dimensionDetails}}"
          wx:key="name"
          class="dimension-row {{item.expanded ? 'open' : ''}}"
          bindtap="toggleDimension"
          data-index="{{index}}"
        >
          <view class="dimension-main">
            <view class="dimension-info">
              <text class="dimension-name">{{item.name}}</text>
              <text class="dimension-sub">约 {{item.score}} 级 · {{item.subtitle}}</text>
            </view>
            <text class="tag {{item.tagClass}} dimension-tag">{{item.tagText}}</text>
            <view class="chevron">⌃</view>
          </view>
          
          <view class="dimension-detail">
            <view class="dimension-detail-inner">
              <text>{{item.detail}}</text>
            </view>
          </view>
        </view>
      </view>

      <!-- 操作区域 -->
      <view class="action-area">
        <text class="action-text">
          想把这些评估转化为具体训练内容？可以根据结果自动生成一份你的专属练习清单。
        </text>
        <!-- 暂时隐藏训练建议功能 -->
        <!-- <button class="btn-primary" bindtap="getTrainingPlan">
          查看训练建议
        </button> -->
        <button class="btn-text" bindtap="shareResult">
          分享结果给教练
          <text class="btn-text-icon">⤴</text>
        </button>
        <button class="btn-text" bindtap="toggleDetail">
          收起详细评语 ↑
        </button>
      </view>
    </view>
  </view>

  <!-- 底部操作栏 (仅简略版显示，且加载完成后显示) -->
  <view wx:if="{{!isLoading && !showDetail}}" class="bottom-bar">
    <button class="btn-bottom" bindtap="goBack">
      <text class="btn-bottom-icon">⬅️</text>
      <text class="btn-bottom-text">返回</text>
    </button>
    
    <button class="btn-bottom" bindtap="toggleDetail">
      <text class="btn-bottom-icon">📝</text>
      <text class="btn-bottom-text">详细</text>
    </button>
    
    <button class="btn-bottom btn-bottom--primary" bindtap="onShareImage">
      <text class="btn-bottom-icon">📤</text>
      <text class="btn-bottom-text">分享</text>
    </button>
  </view>

  <!-- 绘图 Canvas (隐藏) -->
  <canvas type="2d" id="shareCanvas" style="position: fixed; left: -9999px; width: 375px; height: 500px;"></canvas>
</view>
